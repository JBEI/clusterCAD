{% extends "base.html" %}

{% load structureSearch_filters %}

{% block js_content %}
<script>
jQuery(document).ready(function($) {
    $(".clickable-row").click(function() {
        window.location = $(this).data("href");
    });
    $("[data-toggle=popover]").popover({ trigger: 'hover' });
});
</script>
{% endblock %}

{% block subtitle %}
Similarity hits
{% endblock %}

{% block content %}
<h2>Predicted intermediate structure similarity hits</h2>

<div class="row-fluid">
<div class="col-md-12">
<dl class="dl-horizontal">
<dt>Query structure</dt>
<dd><img src="/compounddb/renderer/{{ querySmiles }}?align=False"/></dd>
<dt>Minimum similarity</dt>
<dd>{{ minSim }}</dd>
<dt>Max compounds</dt>
<dd>{{ maxHits }}</dd>
</dl>
</div>
</div><!--/row-->

<div class="row-fluid">
<div class="col-md-12">
<table class="table table-hover table-condensed">
<thead>
<tr>
    <th>
        Hit #
    </th>
    <th>
        Tanimoto similarity
    </th>
    <th>
        MIBiG accession
    </th>
    <th>
        Cluster description
    </th>
    <th>
        Subunit
    </th>
    <th>
        Module
    </th>
</tr>
</thead>
<tbody>
{% for compound in moduleHits %}
    <tr class="clickable-row" data-container="body" data-href="/pks/{{ compound.modules.0.subunit.cluster.mibigAccession }}/?mark={{ compound.modules.0.order }};#{{ compound.modules.0.subunit.name }}" data-content="<img height='213' width= '213' src='/compounddb/renderer/{{ compound.smiles|urlq }}/{{ querySmiles }}?align=False' />" data-toggle="popover" data-placement="top" title="Result vs query maximum common substructure" data-html="true"/">
        <td rowspan="{{ compound.modules|length }}">
            {{ forloop.counter }}
        </td>
        <td rowspan="{{ compound.modules|length }}">
            {{ compound.similarity|floatformat:-3 }}
        </td>
        {% for module in compound.modules %}
            {% if forloop.counter != 1 %} 
                <tr class="clickable-row" data-container="body" data-href="/pks/{{ module.subunit.cluster.mibigAccession }}/?mark={{ module.order }};#{{ module.subunit.name }}" data-content="<img height='213' width= '213' src='/compounddb/renderer/{{ compound.smiles|urlq }}/{{ querySmiles }}?align=False' />" data-toggle="popover" data-placement="top" title="Result vs query maximum common substructure" data-html="true"/">
            {% endif %}
            <td>{{ module.subunit.cluster.mibigAccession }}</td>
            <td>{{ module.subunit.cluster }}</td>
            <td>{{ module.subunit.name }}</td>
            <td>{{ module }}</td>
            </tr>
        {% endfor %} 
{% endfor %}
</tbody>
</table>
</div>
</div>
{% endblock %}
